<p id="notice"><%= notice %></p>

<p>
  <strong>Name:</strong>
  <%= @capitulo.title %>
</p>

<p> <%= @capitulo.serie.name%> : <%= @capitulo.season%>x<%= @capitulo.episode%>
</p>
<p>
  <strong>Descripcion:</strong>
  <%= @capitulo.description%>
</p>

<p>

  <% if @user %>

      <% rating = RatingCapitulo.find_by(user: @user, capitulo: @capitulo) %>

      <% if rating %>
          <% full = rating.value.floor%>
          <% half = 0 %>
          <% if rating.value - full > 0 %>
              <% half = 1 %>
          <% end %>
          <% empty = 5 - full - half%>
          <% half %>

          <% (1..full).each do |i| %>
              <%= image_tag('star-on.png') %>
          <% end %>
          <% (1..half).each do |i| %>
              <%= image_tag('star-half.png') %>
          <% end %>
          <% (1..empty).each do |i| %>
              <%= image_tag('star-off.png') %>
          <% end %>
      <% else %>

          <%= form_tag '/rating_capitulos', :method => 'post' do %>

              <%= number_field_tag :value, params[:value], in: 1..5, value: 1 %>
              <%= hidden_field_tag(:capitulo, @capitulo.id) %>
              <%= hidden_field_tag(:user, @user.id) %>
              <%= submit_tag "Rate!", :name => nil %>

          <% end %>

      <% end %>
  <% end %>


<p>
  <% if @capitulo.seen then%>
      <strong>Visto</strong>
      <%= link_to 'Marcar como no visto', edit_capitulo_path(@capitulo) %> |

<% else %>
      <strong>No visto</strong>
      <%= link_to 'Marcar como visto', edit_capitulo_path(@capitulo) %> |

<%end%>
</p>

<%= link_to 'Edit', edit_capitulo_path(@capitulo) %> |
<%= link_to 'Back', capitulos_path %>
